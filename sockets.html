<!DOCTYPE html>
<html lang="en">
<head>
<title>Berkeley Sockets Examples</title>
<meta charset="UTF-8">
<meta name="author" content="Michael Dipperstein">
<meta name="keywords" content="sokets tcp udp echo client server">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="newlook.css" type="text/css">
</head>
<body>

<div class="navbar">
    <a href="./index.html">Home</a>

    <div class="dropdown">
        <button class="dropbutton">Compression</button>
        <div class="dropdown-items">
            <a href="./arithmetic.html">Arithmetic Coding</a>
            <a href="./bwt.html">Burrows-Wheeler Transform</a>
            <a href="./delta.html">Delta Coding</a>
            <a href="./freq.html">Frequency Substitution</a>
            <a href="./huffman.html">Huffman Coding</a>
            <a href="./lzss.html">LZSS Coding</a>
            <a href="./lzw.html">LZW Coding</a>
            <a href="./rice.html">Rice (Golomb) Coding</a>
            <a href="./rle.html">Run Length Encoding</a>
        </div>
    </div>

    <div class="dropdown">
        <button class="dropbutton">Misc. Programming</button>
        <div class="dropdown-items">
            <a href="./projects.html">School Projects</a>
            <a href="./mltp.html">Thesis Project</a>
            <a href="./crypt.html">crypt(3) Source</a>
            <a href="./hamming.html">Hamming Codes</a>
            <a href="./bitarray.html">Bit Array Libraries</a>
            <a href="./bitfile.html">Bit File Stream Libraries</a>
            <a href="./sqrt.html">Square Root Approximation Library</a>
            <a href="./sort.html">Sort Library</a>
            <a href="./trim.html">Trailing Space Trimmer and Tab Remover</a>
            <a href="./optlist.html">Command Line Option Parser</a>
            <a href="./stopwatch.html">POSIX Stopwatch Library</a>
            <a href="./keypress.html">POSIX Wait for Key Press</a>
            <a href="./ezini.html">INI File Parser and Creator</a>
            <a href="./sockets.html">Berkeley Sockets Examples</a>
        </div>
    </div>
</div><!-- ends navbar-->

<div id="header">
    <h1>Berkeley Sockets Examples</h1>
    <h3>by Michael Dipperstein</h3>
</div>

<hr style="width:100%;">

<h2>About The Software</h2>
<p>Sometime during my senior year in college (1989-90 (I know I'm old)) I
need to write a client and server for an AT&amp;T 3B20 running BSD 4.3,
using the man pages as a guide (I used to own the multi-volume hard copy).
This is not that code.  That code survived on a 3.5&quot; floppy disk that
followed me around for a few years, until I needed it, revised it, and
copied that code to a hard drive.  That code is also not this code.</p>

<p>This code is the result of several iterations of periodically having to
remember how to do something or other with sockets and updating my samples
to use the latest techniques.  Well, not quite.  Since trying to remember
where I put the code was taking up so much time, decided to formalize it and
put it in a location that's <a href="#download">easy to find</a>.  That code
is this code.</p>

<hr style="width:100%;">

<h2>Working with Sockets</h2>
<p>This isn't 1990 and there are tons of socket examples on the Wold Wide
Web (which didn't go public until 1991), but I still feel compelled to
provide a brief outline on how to implement clients and servers.  I'm not
going to discuss TCP vs. UDP, because I may be the only person that ever
uses these notes, and I have yet to need to be reminded about the main
differences between TCP and UDP.</p>

<h3>TCP Servers</h3>
<ol>
    <li>Create a TCP/IP socket with the <code>socket()</code> command.</li>
    <li>Populate a <code>struct sockaddr_in</code> with information about
    the allowable incoming addresses and port being used.</li>
    <li>Use the <code>bind()</code> command to bind the socket to the
    port specified in the <code>struct sockaddr_in</code> stucture.</li>
    <li>Use the <code>listen()</code> command to listen for socket
    connections.</li>
    <li>Use the <code>accept()</code> command to accept incoming connections
    on the socket.</li>
    <li>Receive incoming data with the <code>recv()</code> command.</li>
    <li>Transmit outgoing data with the <code>send()</code> command.</li>
    <li>When you're done with the socket, close it using the
    <code>close()</code> command.</li>
</ol>

<h3>TCP Clients</h3>
<ol>
    <li>Populate a <code>struct addrinfo</code> with information about
    the server that you want to connect to.</li>
    <li>Use the <code>getaddrinfo()</code> command to get a linked list of
    potential Internet addresses matching your request.</li>
    <li>Create a socket with the <code>socket()</code> command on one of the
    addresses returned by <code>getaddrinfo()</code>.</li>
    <li>Use the <code>connect()</code> command to attempt to connect to the
    server (host).
        <ul>
            <li>If the <code>connect()</code> returns with success, use
            <code>freeaddrinfo()</code> to free-up the memory that
            <code>getaddrinfo()</code> allocated.</li>
            <li>If the <code>connect()</code> returns with failure, go to
            step 3, and try another address.</li>
        </ul>
    </li>
    <li>Receive incoming data with the <code>read()</code> command.</li>
    <li>Transmit outgoing data with the <code>write()</code> command.</li>
    <li>When you're done with the socket, close it using the
    <code>close()</code> command.</li>
</ol>

<h3>UDP Servers</h3>
<ol>
    <li>Create a UDP/IP socket with the <code>socket()</code> command.</li>
    <li>Populate a <code>struct sockaddr_in</code> with information about
    the allowable incoming addresses and port being used.</li>
    <li>Use the <code>bind()</code> command to bind the socket to the
    port specified in the <code>struct sockaddr_in</code> stucture.
        <ul>
            <li>UDP sockets are connectionless, so there is need to
            <code>listen()</code> for or <code>accept()</code> connections.
            </li>
        </ul>
    </li>
    <li>Receive incoming data with the <code>recvfrom()</code> command.</li>
    <li>Transmit outgoing data with the <code>sendto()</code> command.</li>
    <li>When you're done with the socket, close it using the
    <code>close()</code> command.</li>
</ol>

<h3>UDP Clients</h3>
<ol>
    <li>Populate a <code>struct addrinfo</code> with information about
    the server that you want to connect to.</li>
    <li>Use the <code>getaddrinfo()</code> command to get a linked list of
    potential Internet addresses matching your request.</li>
    <li>Create a socket with the <code>socket()</code> command on one of the
    addresses returned by <code>getaddrinfo()</code>.
        <ul>
            <li>If the <code>socket()</code> returns with success, copy
            the <code>struct sockaddr</code> that you used, then use
            <code>freeaddrinfo()</code> to free-up the memory that
            <code>getaddrinfo()</code> allocated.</li>
            <li>If the <code>socket()</code> returns with failure, repeat
            this step with the next address from the
            <code>struct addrinfo</code> linked list.</li>
        </ul>
    </li>
    <li>Receive incoming data with the <code>recvfrom()</code> command.</li>
    <li>Transmit outgoing data with the <code>sendto()</code> command.</li>
    <li>When you're done with the socket, close it using the
    <code>close()</code> command.</li>
</ol>

<h2>Using The Software</h2>
<h3>Building Executables from Source</h3>
<p>To build these files with GNU make and gcc:</p>
<ol>
    <li>Open a terminal</li>
    <li>Change directory to the directory containing the source files</li>
    <li>Enter the command <code>make</code> from the command line</li>
</ol>

<h3>Running the Executables</h3>
<p>All of my examples are console programs that may be executed from a
command line prompt in the directory containing their binary images.</p>

<p><strong>NOTE:</strong> It is not possible to mix and match TCP and UDP
client/server pairs.</p>

<h4>echoserver or echoserver_udp</h4>
<p><code>echoserver &lt;port number&gt;<br>
echoserver_udp &lt;port number&gt;</code></p>

<p>The <code>echoserver</code> will not exit until <code>CTRL-c</code>
is pressed.</p>

<h4>echoclient or echoclient_udp</h4>
<p><code>echoclient &lt;server address&gt; &lt;port number&gt;<br>
echoclient_udp &lt;server address&gt; &lt;port number&gt;</code></p>

<p>Hit <code>Enter</code> on a blank line to exit from an
<code>echoclient</code>.<br>
Multiple <code>echoclient</code>s may connect to a single
<code>echoserver</code> instance.</p>

<hr style="width:100%;">

<h2 id="download">Actual Software</h2>
<p>I am releasing my Berkeley Socket examples under the
<a href="https://opensource.org/licenses/BSD-3-Clause">BSD License</a>.
There's no rocket science in the examples.  If you don't like the BSD
License, you could look at my examples and write your own version of code
pretty easily.  The source code repository containing my examples is
available on <a href="https://www.github.com">GitHub</a>.  I recommend that
you checkout the latest revision of the master branch, unless you're looking
for something specific.</p>

<table class="repotable">
  <tr>
    <th>Repository Location</th>
    <th>
      <a href="https://github.com/michaeldipperstein/sockets">
        https://github.com/michaeldipperstein/sockets
      </a>
    </th>
  </tr>
</table>

<hr style="width:100%;">

<h3>Portability</h3>
<p>All the source code that I have provided is written in strict ANSI C.
It requires Berkeley Sockets, so it can't be built on MS Windows platforms
without serious work, but I expect it to build and run on most POSIX
compliant operating systems.</p>

<p>If you have any further questions or comments, you may contact me by
e-mail.  My e-mail address is:
<a href="mailto:mdipperstein@gmail.com">
mdipperstein@gmail.com</a></p>

<p><a href="index.html">Home</a><br>
Last updated on <em>January 3, 2019</em></p>

</body>
</html>
